window.addEventListener("load",function(){Storage.init(),UI.init(),function(){var e=(document.getElementById("sidebar-create"),document.getElementById("note-type"));e.addEventListener("click",function(e){document.getElementById("input-title").value="",document.getElementById("text-area").value="";var t=document.getElementById("category");t.innerHTML="未分类",Content.currentEditNoteID=null,Content.state="edit","text-note"==e.target.getAttribute("id")?(UI.enterWriteMode(),Content.noteType="text"):(UI.enterDrawMode(),Content.noteType="draw",Draw.init())})}(),function(){var e=document.getElementById("view");e.addEventListener("scroll",function(){var t=document.getElementById("title"),n=document.getElementById("over-title");e.scrollTop>t.parentNode.clientHeight?n.innerHTML=t.innerHTML:n.innerHTML=""})}(),function(){var e=document.getElementById("note-book");e.addEventListener("click",function(){UI.updateNoteBookList(),Content.currentNoteBook=null})}(),function(){var e=document.getElementById("new-notebook");e.addEventListener("click",function(){UI.enterAddNoteBookPage()});var t=document.getElementById("newnotebook-cancel");t.addEventListener("click",function(){UI.quitAddNoteBookPage()});var n=document.getElementById("newnotebook-confirm");n.addEventListener("click",function(){this.classList.contains("enable")&&(NoteBook.addNoteBook(),UI.quitAddNoteBookPage(),UI.updateNoteBookList())});var o=document.getElementById("input-notebook-name");o.addEventListener("input",function(){var e=document.getElementById("newnotebook-confirm");this.value?(e.classList.remove("disable"),e.classList.add("enable")):(e.classList.remove("enable"),e.classList.add("disable"))});var a=document.getElementById("notebook-list-target-ul");a.addEventListener("click",function(e){if("p"==e.target.tagName.toLowerCase()){var t=e.target.innerHTML;Content.currentNoteBook=t,NoteList.viewNoteList(t)}else if("i"==e.target.tagName.toLowerCase()){if(e.target.classList.contains("del")){Content.readyToDeleteNoteBookName=e.target.parentNode.parentNode.parentNode.parentNode.firstElementChild.innerHTML,UI.enterDeleteNoteBookPage();var n=document.getElementById("delete-notebook-name");n.innerHTML=Content.readyToDeleteNoteBookName}else Content.readyToRenameNoteBookName=e.target.parentNode.parentNode.parentNode.parentNode.firstElementChild.innerHTML,UI.enterRenameNoteBookPage();e.stopPropagation()}});var r=document.getElementById("delete-notebook-delete");r.addEventListener("click",function(){Storage.deleteNoteBook(Content.readyToDeleteNoteBookName),UI.quitDeleteNoteBookPage(),UI.updateNoteBookList()});var d=document.getElementById("delete-notebook-cancel");d.addEventListener("click",function(){UI.quitDeleteNoteBookPage()});var i=document.getElementById("renamenotebook-cancal");i.addEventListener("click",function(){UI.quitRenameNoteBookPage()});var c=document.getElementById("renamenotebook-confirm");c.addEventListener("click",function(e){var t=document.getElementById("input-rename-notebook-name").value;t&&(Storage.renameNoteBook(Content.readyToRenameNoteBookName,t),UI.quitRenameNoteBookPage(),UI.updateNoteBookList())})}(),function(){var e=document.getElementById("sidebar-note");e.addEventListener("click",function(){NoteList.viewNoteList()})}(),function(){var e=document.getElementById("save");e.addEventListener("click",function(){var e=document.getElementById("input-title"),t=e.value;if(t){var n="";n="text"==Content.noteType?document.getElementById("text-area").value:document.getElementById("palette").toDataURL("image/png");var o=document.getElementById("category").innerHTML,a=new Note(t,n,o,Content.noteType,Content.currentEditNoteID),r=Storage.storeNote(a);Content.currentViewNoteID=r,NoteList.updateList(),UI.enterViewMode(),UI.updateContent(a)}else e.setAttribute("class","shake animated"),setTimeout(function(){e.setAttribute("class","")},1e3)});var t=document.getElementById("edit");t.addEventListener("click",function(){UI.enterWriteMode(),UI.editNote(Content.currentViewNoteID),Content.currentEditNoteID=Content.currentViewNoteID});var n=document.getElementById("full-screen");n.addEventListener("click",function(){UI.enterFullSrceenMode()});var o=document.getElementById("exit");o.addEventListener("click",function(){UI.exitFullScreenMode()})}(),function(){var e=document.getElementById("note-list-target-ul");e.addEventListener("click",function(e){var t=e.target.tagName.toLowerCase();if("p"==t){var n=document.getElementsByClassName("list-selected");n.length>0&&n[0].classList.remove("list-selected"),e.target.classList.add("list-selected"),UI.enterViewMode(),UI.updateContent(e.target.dataset.id),Content.currentViewNoteID=e.target.dataset.id,Content.noteType=e.target.dataset.type}else if("i"==t){var o=function(e){var t=e.parentNode.parentNode.parentNode.parentNode.firstElementChild;return t},a=o(e.target),r=a.innerHTML;UI.enterDeleteNotePage(r),Content.readyToDeleteNoteID=a.dataset.id}});var t=document.getElementById("delete-note-op");t.addEventListener("click",function(e){var t=e.target.getAttribute("id");"delete-note-delete"==t?(Storage.deleteNote(Content.readyToDeleteNoteID),UI.quitDeleteNotePage(),NoteList.updateList(),UI.updateContent()):"delete-note-cancel"==t&&UI.quitDeleteNotePage()})}(),function(){var e=document.getElementById("select-category"),t=document.getElementById("drop-down");e.addEventListener("click",function(){CategorySelectList.updateList(),t.style.display="block"});var n=document.getElementById("category-select-list");n.addEventListener("click",function(e){var t=e.target.innerHTML,n=document.getElementsByClassName("category-select");n.length>0&&n[0].classList.remove("category-select"),e.target.parentNode.classList.add("category-select"),document.getElementById("category").innerHTML=t,e.stopPropagation()}),t.addEventListener("mouseleave",function(){t.style.display="none"})}(),function(){var e=document.getElementById("palette");e.addEventListener("mousemove",function(e){Draw.mouseDown===!0&&("draw"==Draw.mode?(Draw.draw({x:e.pageX,y:e.pageY}),Draw.oldPoint.x=e.pageX,Draw.oldPoint.y=e.pageY):Draw.eraser({x:e.pageX,y:e.pageY}))},!1),e.addEventListener("mousedown",function(e){Draw.mouseDown=!0,Draw.oldPoint.x=e.pageX,Draw.oldPoint.y=e.pageY},!1),e.addEventListener("mouseup",function(){Draw.mouseDown=!1},!1),e.addEventListener("mouseenter",function(){"eraser"==Draw.mode?event.currentTarget.classList.add("eraser"):event.currentTarget.classList.remove("eraser")}),e.addEventListener("dblclick",function(e){console.log(e.currentTarget);var t=e.currentTarget.toDataURL("image/png");console.log(t)});var t=document.getElementById("select-eraser");t.addEventListener("click",function(e){Draw.mode="eraser",Draw.eraserSize=e.target.dataset.size},!1);var n=document.getElementById("selece-panWidth");n.addEventListener("click",function(e){Draw.mode="draw",console.log(e.target.dataset.size),Draw.cxt.lineWidth=2*e.target.dataset.size},!1)}()});var Content={currentNoteBook:null,currentNote:null,state:"view",currentEditNoteID:null,currentViewNoteID:null,noteType:"text"};